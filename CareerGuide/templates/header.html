<header class="main-header" id="mainHeader">
  <div class="header-container">
    <a href="/" class="logo">CareerGuide</a>
    <div style="display: flex; align-items: center; gap: 20px;">
      <nav class="nav-menu">
        <a href="/questions" class="nav-link" id="questions-link">Тест</a>
        <a href="/results" class="nav-link" id="results-link">Результаты</a>
        <a href="/chat/" class="nav-link" id="chat-link">Чат-бот</a>
        <a href="/all" class="nav-link" id="all-link">Все типы</a>
      </nav>
      <div style="display: flex; align-items: center; gap: 10px;">
        <button class="settings-toggle" id="settingsToggle" title="Настройки">
          <svg class="settings-icon" id="settingsIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Панель настроек -->
<div class="settings-panel" id="settingsPanel">
  <h3>Настройки</h3>
  <div class="setting-item">
    <div class="setting-label">
      <span>Темная тема</span>
      <label class="toggle-switch">
        <input type="checkbox" id="darkThemeToggle">
        <span class="slider"></span>
      </label>
    </div>
  </div>
  <div class="setting-item">
    <div class="setting-label">
      <span>Уведомления</span>
      <label class="toggle-switch">
        <input type="checkbox" id="notificationsToggle">
        <span class="slider"></span>
      </label>
    </div>
  </div>
  <div class="setting-item">
    <div class="setting-label">
      <span>Профиль</span>
      <button class="btn" style="padding: 5px 10px; font-size: 12px;" onclick="openProfileModal()">Открыть</button>
    </div>
  </div>
</div>

<script>
    // Add user ID to navigation links
    document.addEventListener('DOMContentLoaded', function() {
        // Extract user ID from existing API calls in the page
        function extractUserIdFromPage() {
            // First try to get from the global variable set by header.js
            if (window.pageUserId) {
                return window.pageUserId;
            }
            
            // Look for user_id in fetch calls
            const scripts = document.querySelectorAll('script');
            for (const script of scripts) {
                const scriptContent = script.textContent || script.innerText;
                if (scriptContent) {
                    const match = scriptContent.match(/user_id=(\d+)/);
                    if (match && match[1]) {
                        return match[1];
                    }
                }
            }
            
            // Alternative: look for user_id in data attributes or hidden inputs
            const userInputElement = document.querySelector('input[name="user_id"], #user_id');
            if (userInputElement && userInputElement.value) {
                return userInputElement.value;
            }
            
            // Try to get from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const userIdFromUrl = urlParams.get('user_id');
            if (userIdFromUrl) {
                return userIdFromUrl;
            }
            
            // Try to get from localStorage as a fallback
            const userIdFromStorage = localStorage.getItem('user_id');
            if (userIdFromStorage) {
                return userIdFromStorage;
            }
            
            return null;
        }
        
        const userId = extractUserIdFromPage();
        
        // Store user ID in localStorage for persistence
        if (userId) {
            localStorage.setItem('user_id', userId);
        }
        
        if (userId) {
            // Update navigation links to include user ID
            const links = [
                { id: 'questions-link', base: '/questions' },
                { id: 'results-link', base: '/results' },
                { id: 'chat-link', base: '/chat/' },
                { id: 'all-link', base: '/all' }
            ];
            
            links.forEach(link => {
                const element = document.getElementById(link.id);
                if (element) {
                    element.href = `${link.base}?user_id=${userId}`;
                }
            });
        }
        
        // Make openProfileModal function available globally
        window.openProfileModal = function() {
            // Скрываем панель настроек
            document.getElementById('settingsPanel').style.display = 'none';
            document.getElementById('settingsIcon').classList.remove('open');
            
            // Проверяем, есть ли функция loadCurrentProfileData на странице
            if (typeof loadCurrentProfileData === 'function') {
                // Загружаем текущие данные профиля
                loadCurrentProfileData();
            }
            
            // Показываем модальное окно профиля, если оно есть на странице
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                profileModal.style.display = 'flex';
            } else {
                // Если модального окна нет на странице, переходим на страницу профиля
                if (userId) {
                    window.location.href = `/profile?user_id=${userId}`;
                } else {
                    window.location.href = '/profile';
                }
            }
        };
        
        // Also make userId available globally for other scripts
        window.user_id = userId;
    });
    
    // Header scroll behavior
    let lastScrollTop = 0;
    const header = document.getElementById('mainHeader');
    
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // Scrolling down - hide header
            header.style.transform = 'translateY(-100%)';
            header.style.transition = 'transform 0.3s ease';
        } else {
            // Scrolling up - show header
            header.style.transform = 'translateY(0)';
            header.style.transition = 'transform 0.3s ease';
        }
        
        lastScrollTop = scrollTop;
    });
    
    // Theme toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
        const body = document.body;
        
        // Settings panel functionality
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsPanel = document.getElementById('settingsPanel');
        const settingsIcon = document.getElementById('settingsIcon');
        
        // Проверяем сохраненную тему в localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-theme');
        }
        
        // Settings panel toggle with rotation animation
        settingsToggle.addEventListener('click', function() {
            if (settingsPanel.style.display === 'block') {
                // Closing panel - rotate back to original position
                settingsIcon.classList.remove('open');
                settingsPanel.style.display = 'none';
            } else {
                // Opening panel - rotate icon
                settingsIcon.classList.add('open');
                settingsPanel.style.display = 'block';
            }
        });
        
        // Close settings panel when clicking outside
        document.addEventListener('click', function(event) {
            if (!settingsPanel.contains(event.target) && 
                event.target !== settingsToggle && 
                !settingsToggle.contains(event.target)) {
                settingsPanel.style.display = 'none';
                settingsIcon.classList.remove('open');
            }
        });
        
        // Dark theme toggle in settings panel
        const darkThemeToggle = document.getElementById('darkThemeToggle');
        if (darkThemeToggle) {
            // Set initial state
            if (savedTheme === 'dark') {
                darkThemeToggle.checked = true;
            }
            
            darkThemeToggle.addEventListener('change', function() {
                if (this.checked) {
                    body.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                }
            });
        }
    });
</script>